---
title: "IBM Attrition"
output:
  pdf_document: default
  html_document:
    df_print: paged
  html_notebook: default
---

1.  Exploratory Data Analysis: Queremos saber si la variable en cuestión (Attrition o cualquier otra) está (muy) desbalanceada; qué "resúmenes" podemos hacer con los datos iniciales, también mirar si hay valores faltantes y optar por excluirlos o asignarles un valor por default.

```{r}
library(ggplot2)
library(ggcorrplot)
library(caret)
library(dplyr)
library(recipes)

# Cargar Data set
employee_data <-
  read.csv("/home/sebas/Downloads/WA_Fn-UseC_-HR-Employee-Attrition.csv")
```

```{r}
attrition_freq <- table(employee_data$Attrition)
attrition_freq
attrition_prop <- prop.table(attrition_freq)
attrition_prop
barplot(attrition_freq,
        main = "Employee Attrition Distribution",
        ylab = "Count",
        xlab = "Attrition",
        col = c("steelblue", "tomato"))
```

Hemos concluído que la variable en cuestión sí está desbalanceada. Por lo cual, el análisis que vamos a llevar a cabo escogerá determinados algoritmos y modelos para compensar dicho desbalance en los datos.

2.  Para continuar, vamos a dividir el data set entre el conjunto de entrenamiento y el conjunto de test.

```{r}
# Set seed for reproducibility
set.seed(42)

# Stratified 80/20 train/test split on Attrition
split_idx <- createDataPartition(employee_data$Attrition, p = 0.8, list = FALSE)
train <- employee_data[split_idx, ]
test  <- employee_data[-split_idx, ]
```

3.  Ahora vamos a realizar un análisis de correlación entre las variables del conjunto de entrenamiento. Esto nos ayudará a identificar si hay variables que están altamente correlacionadas entre sí, lo cual podría afectar el rendimiento de algunos modelos.

```{r}
# Preprocess: remove near-zero variance predictors
# and convert categoricals to dummies
train_processed <- recipe(~ ., data = train) %>%
  step_nzv(all_predictors()) %>%
  step_dummy(all_nominal_predictors()) %>%
  prep(training = train) %>%
  bake(new_data = train)

# Compute correlation matrix
correlation_matrix_all <- cor(train_processed)
```

```{r}
correlation_masked <- correlation_matrix_all
correlation_masked[abs(correlation_matrix_all) <= 0.7] <- NA

# Clean and minimalist correlation plot
ggcorrplot(
  correlation_masked,
  type       = "lower",
  hc.order   = FALSE,
  lab        = FALSE,
  show.diag  = FALSE,
  colors     = c("#6D9EC1", "white", "#E46726"),
  outline.color = "gray80",
  ggtheme    = theme_minimal(base_size = 8)
) +
  theme(
    axis.text.x = element_text(
      angle = 60, hjust = 1, size = 6, color = "gray20"
    ),
    axis.text.y = element_text(
      size = 6, color = "gray20"
    ),
    plot.title = element_text(size = 14, face = "bold"),
    legend.title = element_text(size = 9),
    legend.text = element_text(size = 8)
  ) +
  labs(
    title = "Correlation Matrix",
    x = NULL,
    y = NULL
  )
```
